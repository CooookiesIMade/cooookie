<!DOCTYPE html>
<html>

<head th:replace="~{header :: #header}"></head>

<head th:replace="~{head :: #head}"></head>

<head th:replace="~{personCategory :: #personCategory}"></head>

<link rel="stylesheet" href="/css/user.css" />

<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>
	var element = $('#wrap');
	function foldPostcode() {
		element.style.display = 'none';
	}

	// 주소 가지고 오기 위한 함수
	function daumPostcode() {
		new daum.Postcode({
			oncomplete :function(data){
				console.log(data.address)
                $("#address").val(data.address);
                // 커서를 상세주소 필드로 이동한다.
                $("#detailAddress").focus();
			}
		}).open();
	}
	
	// 파일업로드 눌렀을때 실행되는 함수
	function clickUpload(){
		let myInput = $("#my-input");
		myInput.click();
		
		myInput.on("change", function(event){
			var file = event.target.files[0];
			var reader = new FileReader();
			reader.onload = function(e){
				$(".preview").attr("src", e.target.result);
				$(".preview").addClass('show');
				$(".delete").append(`<button class="delbtn" onclick="closeUpload()">X</button>`)
			}
			reader.readAsDataURL(file);
		}) 
	}
	// 파일 닫기
	function closeUpload(){
			$(".preview").removeClass('show');
			$(".preview").remove();
			$(".delete").remove()
	}
</script>

<body>
	<!-- header section strats -->
	<form action="register" method="post" enctype="multipart/form-data" th:object="${personRegister}">
  	<div th:if="${#fields.hasGlobalErrors()}">
 	  	<p class="error" th:each="err : ${#fields.globalErrors}" th:text="${err}">
  	</div>
	<div th:replace="header"></div>
		<div class="reg-div">
		<div class="formContainer">
			<section class="reg-box">
				<p class="reg-title">사람 등록</p>
			</section>
	
	<div class="reg-div">
		<div class="formContainer">
			<section class="reg-box">
				<p class="reg-title">제목</p>
				<input class="re-input" th:field="*{person_name}">
				<div class="error" th:errors="*{person_name}"></div>
			</section>
			
			<section class="reg-box">
				<p class="reg-title">카테고리</p>
				<div th:replace="personCategory" ></div>
				<div class="error" th:errors="*{person_category}"></div>
			</section>
			
			<section class="reg-box">
				<p class="reg-title">상세정보</p>
				<textarea th:field="*{person_content}"></textarea>
				<div class="error" th:errors="*{person_content}"></div>
			</section>
			
			<section class="reg-box">
				<p class="reg-title">사진</p>
				<label for="person_profile">
					<button class="ibutton" onclick="clickUpload()" type="button">사진 업로드하기</button>
				</label>
				<input type="file" accept="image/*" id="my-input" name="file" style="display: none;">
				<img class="preview">
				<div class="delete">
			</section>
	
			<section class="b-wrapper">
				<input type="submit" class="reg-button"></input>
			</section>
			<div id="wrap"
				style="display:none;border:1px solid;width:500px;height:300px;margin:5px 0;position:relative">
				<img src="//t1.daumcdn.net/postcode/resource/images/close.png" id="btnFoldWrap"
					style="cursor:pointer;position:absolute;right:0px;top:-1px;z-index:1" onclick="foldPostcode()"
					alt="접기 버튼">
			</div>
		</div>
	</div>
	</form>
</body>

</html>